#include <iostream>
#include <fstream>
using namespace std;
void growarray(int **&aa, int &size)
{
    int **temp;
    temp = new int *[size + 1];
    for (int i = 0; i < 3; i++)
    {
        *(aa + i) = new int[3];
    }
    for (int i = 0; i < size; i++)
    {
        for (int j = 0; j < 3; j++)
        {
            temp[i][j] = aa[i][j];
        }
    }
    size++;
    aa = temp;
}
void transpose(int **&aa, int size, int &r, int &c, int *q)
{
    int hehe = r;
    r = c;
    c = hehe;
    // for (int j = 0; j < r; j++)
    {

        for (int i = 0; i < size; i++)
        {
            int temp = aa[i][1];
            aa[i][1] = aa[i][0];
            aa[i][0] = temp;
        }
    }
    cout << "The sparse matrix is: " << endl;
    for (int i = 0; i < size; i++)
    {
        for (int j = 0; j < 3; j++)
            cout << aa[i][j] << "\t";
        cout << endl;
    }
    ////========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
    //
    //    ###     ####   ####  #####  ##     ##  ####    ##  ##     ##   ####           #####   #####    ####    #####  #####          #####  ##    ##  ##   ####  ######   ####
    //   ## ##   ##     ##     ##     ####   ##  ##  ##  ##  ####   ##  ##             ##   ##  ##  ##   ##  ##  ##     ##  ##         ##      ##  ##   ##  ##       ##    ##
    //  ##   ##  ##      ###   #####  ##  ## ##  ##  ##  ##  ##  ## ##  ##  ###        ##   ##  #####    ##  ##  #####  #####          #####    ####    ##   ###     ##     ###
    //  #######  ##        ##  ##     ##    ###  ##  ##  ##  ##    ###  ##   ##        ##   ##  ##  ##   ##  ##  ##     ##  ##         ##      ##  ##   ##     ##    ##       ##
    //  ##   ##   ####  ####   #####  ##     ##  ####    ##  ##     ##   ####           #####   ##   ##  ####    #####  ##   ##        #####  ##    ##  ##  ####     ##    ####
    //
    //========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    int l = size;
    int check;
    for (int i = 0; i < l; i++)
    {
        int max = aa[0][0];
        for (int j = 0; j < size; j++)
        {
            if (max <= aa[j][0])
            {
                max = aa[j][0];
                check = j;
            }
        }
        swap(aa[size - 1][0], aa[check][0]);
        swap(aa[size - 1][1], aa[check][1]);
        swap(aa[size - 1][2], aa[check][2]);
        size--;
    }
    size = l;
    for (int i = 0; i < r; i++)
    {
        for (int j = 0; j < l; j++)
        {
            if (aa[j])
            ;
        }
    }
    cout << "The sparse matrix after sorting is: " << endl;
    for (int i = 0; i < size; i++)
    {
        for (int j = 0; j < 3; j++)
            cout << aa[i][j] << "\t";
        cout << endl;
    }
}

void add(int r, int c, int r1, int c1, int **&a, int **&b, int **&w, int **&w1, int *&q, int *&q1, int **&aa, int **&bb, int &size, int &size1)
{
    for (int i = 0; i < size; i++)
    {
        for (int j = 0; j < size1; j++)
        {
            if (aa[i][0] == bb[j][0] && aa[i][1] == bb[j][1])
            {
                aa[i][2] += bb[i][2];
                break;
            }
        }
    }

    for (int i = 0; i < size1; i++)
    {
        int flag = 0;
        for (int j = 0; j < size; j++)
        {
            if (bb[i][0] == aa[j][0] && bb[i][1] == aa[j][1])
            {
                flag = 1;
                break;
            }
        }
    
        if (flag == 0)
        {
            //growarray(aa, size);
            aa[size - 1][0] = bb[i][0];
            aa[size - 1][1] = bb[i][1];
            aa[size - 1][2] = bb[i][2];
        }
    }
}
void output(int &r, int &c, int **&a, int **&w, int *&q, int **&aa, int size)
{

    int k = 0;
    for (int i = 0; i < r; i++)
    {
        for (int j = 0; j < c; j++)
        {
            if (i == aa[k][0] && j == aa[k][1])
            {
                if (aa[k][2] < 9)
                {
                    cout << aa[k][2] << "    ";
                    k++;
                }
                else if (aa[k][2] > 9 && aa[k][2] < 100)
                {
                    cout << aa[k][2] << "   ";
                    k++;
                }
                else if (aa[k][2] > 99 && aa[k][2] < 1000)
                {
                    cout << aa[k][2] << "  ";
                    k++;
                }
                else if (aa[k][2] > 999 && aa[k][2] < 10000)
                {
                    cout << aa[k][2] << " ";
                    k++;
                }
            }
            else
                cout << "0"
                     << "    ";
        }
        cout << endl;
    }
}
void output2(int &r, int &c, int **&a, int **&w, int *&q, int **&aa, int size)
{

    int k = 0;
    for (int j = 0; j < r; j++)
    {
        for (int i = 0; i < c; i++)
        {
            if (j == aa[k][0] && i == aa[k][1])
            {
                if (aa[k][2] < 9)
                {
                    cout << aa[k][2] << "    ";
                    k++;
                }
                else if (aa[k][2] > 9 && aa[k][2] < 100)
                {
                    cout << aa[k][2] << "   ";
                    k++;
                }
                else if (aa[k][2] > 99 && aa[k][2] < 1000)
                {
                    cout << aa[k][2] << "  ";
                    k++;
                }
                else if (aa[k][2] > 999 && aa[k][2] < 10000)
                {
                    cout << aa[k][2] << " ";
                    k++;
                }
            }
            else
                cout << "0"
                     << "    ";
        }
        cout << endl;
    }
}

void input(int &r, int &c, int **&a, int **&w, int *&q, int **&aa, int &size)
{
    int test, test2, test3;
    ifstream fin("input.txt");
    fin >> r >> c;
    a = new int *[r];

    q = new int[r];
    w = new int *[r];
    for (int i = 0; i < r; i++)
    {
        fin >> q[i];
        *(a + i) = new int[q[i]];
        *(w + i) = new int[q[i]];
        for (int j = 0; j < q[i]; j++)
        {
            fin >> w[i][j];
            fin >> a[i][j];
        }
    }
    size = 0;
    for (int i = 0; i < r; i++)
        size += q[i];
    ////===============================================================================================================================================================================================================================================================================================================================================================================================================
    //
    //   ####  #####     ###    #####     ####  #####
    //  ##     ##  ##   ## ##   ##  ##   ##     ##
    //   ###   #####   ##   ##  #####     ###   #####
    //     ##  ##      #######  ##  ##      ##  ##
    //  ####   ##      ##   ##  ##   ##  ####   #####
    //
    //===============================================================================================================================================================================================================================================================================================================================================================================================================
    aa = new int *[size];
    for (int i = 0; i < size; i++)
    {
        *(aa + i) = new int[3];
    }
    int t = 0, jj = 0;
    for (int i = 0; i < r; i++)
    {
        for (int j = 0; j < q[i]; j++)
        {
            aa[jj][0] = t;
            // cout<<t<<"\t";
            jj++;
        }
        t++;
    }
    jj = 0;
    for (int i = 0; i < r; i++)
    {
        for (int j = 0; j < q[i]; j++)
        {
            aa[jj][1] = w[i][j];
            jj++;
        }
    }
    jj = 0;
    for (int i = 0; i < r; i++)
    {
        for (int j = 0; j < q[i]; j++)
        {
            aa[jj][2] = a[i][j];
            jj++;
        }
    }
    ////==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
    //
    //   ####  #####   #####    #####  #####   #####    #####   ####  ##     ##  ######    ###    ######  ##   #####   ##     ##
    //  ##     ##  ##  ##  ##   ##     ##  ##  ##  ##   ##     ##     ####   ##    ##     ## ##     ##    ##  ##   ##  ####   ##
    //   ###   #####   #####    #####  #####   #####    #####   ###   ##  ## ##    ##    ##   ##    ##    ##  ##   ##  ##  ## ##
    //     ##  ##      ##  ##   ##     ##      ##  ##   ##        ##  ##    ###    ##    #######    ##    ##  ##   ##  ##    ###
    //  ####   ##      ##   ##  #####  ##      ##   ##  #####  ####   ##     ##    ##    ##   ##    ##    ##   #####   ##     ##
    //
    //==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    cout << "The sparse matrix is: " << endl;
    for (int i = 0; i < size; i++)
    {
        for (int j = 0; j < 3; j++)
            cout << aa[i][j] << "\t";
        cout << endl;
    }
}

void input2(int &r, int &c, int **&a, int **&w, int *&q, int **&aa, int &size)
{
    int test, test2, test3;
    ifstream fin("input2.txt");
    fin >> r >> c;
    a = new int *[r];

    q = new int[r];
    w = new int *[r];
    for (int i = 0; i < r; i++)
    {
        fin >> q[i];
        *(a + i) = new int[q[i]];
        *(w + i) = new int[q[i]];
        for (int j = 0; j < q[i]; j++)
        {
            fin >> w[i][j];
            fin >> a[i][j];
        }
    }
    size = 0;
    for (int i = 0; i < r; i++)
        size += q[i];
    ////===============================================================================================================================================================================================================================================================================================================================================================================================================
    //
    //   ####  #####     ###    #####     ####  #####
    //  ##     ##  ##   ## ##   ##  ##   ##     ##
    //   ###   #####   ##   ##  #####     ###   #####
    //     ##  ##      #######  ##  ##      ##  ##
    //  ####   ##      ##   ##  ##   ##  ####   #####
    //
    //===============================================================================================================================================================================================================================================================================================================================================================================================================
    aa = new int *[size];
    for (int i = 0; i < size; i++)
    {
        *(aa + i) = new int[3];
    }
    int t = 0, jj = 0;
    for (int i = 0; i < r; i++)
    {
        for (int j = 0; j < q[i]; j++)
        {
            aa[jj][0] = t;
            // cout<<t<<"\t";
            jj++;
        }
        t++;
    }
    jj = 0;
    for (int i = 0; i < r; i++)
    {
        for (int j = 0; j < q[i]; j++)
        {
            aa[jj][1] = w[i][j];
            jj++;
        }
    }
    jj = 0;
    for (int i = 0; i < r; i++)
    {
        for (int j = 0; j < q[i]; j++)
        {
            aa[jj][2] = a[i][j];
            jj++;
        }
    }
    ////==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
    //
    //   ####  #####   #####    #####  #####   #####    #####   ####  ##     ##  ######    ###    ######  ##   #####   ##     ##
    //  ##     ##  ##  ##  ##   ##     ##  ##  ##  ##   ##     ##     ####   ##    ##     ## ##     ##    ##  ##   ##  ####   ##
    //   ###   #####   #####    #####  #####   #####    #####   ###   ##  ## ##    ##    ##   ##    ##    ##  ##   ##  ##  ## ##
    //     ##  ##      ##  ##   ##     ##      ##  ##   ##        ##  ##    ###    ##    #######    ##    ##  ##   ##  ##    ###
    //  ####   ##      ##   ##  #####  ##      ##   ##  #####  ####   ##     ##    ##    ##   ##    ##    ##   #####   ##     ##
    //
    //==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    cout << "The sparse matrix is: " << endl;
    for (int i = 0; i < size; i++)
    {
        for (int j = 0; j < 3; j++)
            cout << aa[i][j] << "\t";
        cout << endl;
    }
}
    int main()
    {
        ifstream fin("input.txt");
        int r, r1, c, c1;
        int **a;
        int *q;
        int **w;
        int **aa;
        int **b;
        int *q1;
        int **w1;
        int **bb;
        int size, size1;
        char opt;
        cout << "Enter the size of rows and columns respectively: " << endl;
        input(r, c, a, w, q, aa, size);
        cout << "Your matrix is: " << endl;
        output(r, c, a, w, q, aa, size);
        while (9696)
        {
            cout << "Select an option to perform a calculation!" << endl;
            cout << "Hit 1 to calculate transpose of the given matrix." << endl;
            cout << "Or hit 2 to add it to other matrix. " << endl;
            cout << "Or hit 3 to multiply it to another matrix: " << endl;
            cout << "Or hit 4 to close the program." << endl;
            cin >> opt;
            if (opt == '4')
            {
                cout << "Program closed successfully!";
                delete[] a;
                delete[] aa;
                delete[] w;
                delete[] q;
                // delete[] b;
                // delete[] bb;
                // delete[] q1;
                // delete[] w1;
                a = nullptr;
                aa = nullptr;
                w = nullptr;
                q = nullptr;
                // b = nullptr;
                // w1 = nullptr;
                // q1 = nullptr;
                // bb = nullptr;
                break;
            }
            if (opt == '2')
            {
                cout << "Fetching data for the 2nd matrix from the file...." << endl;
                input2(r1, c1, b, w1, q1, bb, size1);
                cout << "Your 2nd matrix is: " << endl;
                output(r1, c1, b, w1, q1, bb, size1);
                if (r1 != r || c1 != c)
                {
                    cout << "The given matrices are incompatible for addition!" << endl;
                }
                else
                {
                    add(r, c, r1, c1, a, b, w, w1, q, q1, aa, bb, size, size1);
                    cout << "The addition of the matrices is: " << endl;
                    output(r, c, a, w, q, aa, size);
                }
            }
            if (opt == '1')
            {
                cout << "The transpose of the given matrix is: " << endl;
                transpose(aa, size, r, c, q);
                output(r, c, a, w, q, aa, size);
            }
        }
    }
